<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>印章系統後台管理 | Stamp System Admin</title>
    
    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%239fb28e' /%3E%3Ctext x='50' y='67' font-family='Arial' font-size='50' font-weight='bold' text-anchor='middle' fill='white'%3E印%3C/text%3E%3C/svg%3E">
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Admin CSS -->
    <link rel="stylesheet" href="admin.css">
    
    <!-- 防止被 iframe 嵌入 -->
    <script>
        if (window.top !== window.self) {
            window.top.location = window.self.location;
        }
    </script>
    
    <style>
        /* 初始載入動畫 */
        .initial-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #dde5d6;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }
        
        .loader-content {
            text-align: center;
        }
        
        .loader-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
            background: #9fb28e;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(159, 178, 142, 0.3);
            animation: pulse 2s ease-in-out infinite;
        }
        
        .loader-logo .material-icons {
            font-size: 40px;
            color: white;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .loader-text {
            color: #84736a;
            font-size: 16px;
            font-weight: 500;
            opacity: 0;
            animation: fadeIn 0.5s ease 0.3s forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .loader-progress {
            width: 200px;
            height: 4px;
            background: rgba(132, 115, 106, 0.1);
            border-radius: 2px;
            margin: 16px auto 0;
            overflow: hidden;
        }
        
        .loader-progress-bar {
            height: 100%;
            background: #9fb28e;
            border-radius: 2px;
            animation: loading 2s ease-in-out infinite;
        }
        
        @keyframes loading {
            0% { width: 0; transform: translateX(0); }
            50% { width: 100%; transform: translateX(0); }
            100% { width: 100%; transform: translateX(100%); }
        }
    </style>
</head>
<body>
    <!-- 初始載入畫面 -->
    <div class="initial-loader" id="initialLoader">
        <div class="loader-content">
            <div class="loader-logo">
                <span class="material-icons">admin_panel_settings</span>
            </div>
            <div class="loader-text">印章系統載入中...</div>
            <div class="loader-progress">
                <div class="loader-progress-bar"></div>
            </div>
        </div>
    </div>
    
    <!-- 主要內容區域 (由 JavaScript 動態生成) -->
    
    <!-- 通知容器 -->
    <div id="notificationContainer" class="notification-container"></div>
    
    <!-- 防截圖保護層 -->
    <div id="screenshotProtection" class="screenshot-protection">
        <span class="material-icons">no_photography</span>
        <p>禁止截圖</p>
    </div>
    
    <!-- 浮水印層 (後台用) -->
    <div id="watermarkLayer" class="watermark-layer"></div>
    
    <!-- 載入必要的函式庫 -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    
    <!-- Admin JavaScript -->
    <script src="admin.js"></script>
    
    <script>
        // 系統初始化
        window.addEventListener('load', function() {
            // 移除載入畫面
            setTimeout(() => {
                const loader = document.getElementById('initialLoader');
                if (loader) {
                    loader.style.opacity = '0';
                    setTimeout(() => loader.remove(), 500);
                }
            }, 1000);
        });
        
        // 效能監控
        if ('performance' in window) {
            window.addEventListener('load', function() {
                const perfData = window.performance.timing;
                const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
                console.log(`⚡ 頁面載入時間: ${pageLoadTime}ms`);
            });
        }
        
        // 網路狀態監控
        let isOnline = navigator.onLine;
        
        window.addEventListener('online', function() {
            if (!isOnline) {
                isOnline = true;
                console.log('🌐 網路已連線');
                if (window.showNotification) {
                    window.showNotification('網路已恢復連線', 'success');
                }
            }
        });
        
        window.addEventListener('offline', function() {
            isOnline = false;
            console.log('📵 網路已斷線');
            if (window.showNotification) {
                window.showNotification('網路連線中斷，部分功能可能無法使用', 'warning');
            }
        });
        
        // 瀏覽器相容性檢查
        (function checkCompatibility() {
            const features = {
                'CSS.supports': CSS && CSS.supports,
                'backdrop-filter': CSS && CSS.supports && (CSS.supports('backdrop-filter', 'blur(10px)') || CSS.supports('-webkit-backdrop-filter', 'blur(10px)')),
                'IntersectionObserver': 'IntersectionObserver' in window,
                'ResizeObserver': 'ResizeObserver' in window
            };
            
            const unsupported = Object.entries(features)
                .filter(([name, supported]) => !supported)
                .map(([name]) => name);
            
            if (unsupported.length > 0) {
                console.warn('⚠️ 瀏覽器不完全支援以下功能:', unsupported);
            }
        })();
        
        // 自動儲存功能
        let autoSaveTimer;
        window.enableAutoSave = function(callback, interval = 30000) {
            if (autoSaveTimer) clearInterval(autoSaveTimer);
            autoSaveTimer = setInterval(callback, interval);
        };
        
        window.disableAutoSave = function() {
            if (autoSaveTimer) {
                clearInterval(autoSaveTimer);
                autoSaveTimer = null;
            }
        };
        
        // 鍵盤快捷鍵提示
        console.log('%c⌨️ 快捷鍵:', 'font-size: 14px; font-weight: bold;');
        console.log('Ctrl+S - 儲存設定');
        console.log('Ctrl+O - 載入設定');
        console.log('Ctrl+E - 匯出設定');
        console.log('Ctrl+/ - 顯示快捷鍵');
        
        // 錯誤處理
        window.addEventListener('error', function(e) {
            console.error('❌ 系統錯誤:', e.error);
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            console.error('❌ Promise 錯誤:', e.reason);
            e.preventDefault();
        });
    </script>
    
    <!-- Meta 標籤 -->
    <meta name="robots" content="noindex, nofollow">
    <meta name="theme-color" content="#9fb28e">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- 防止快取敏感資料 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</body>
</html>
