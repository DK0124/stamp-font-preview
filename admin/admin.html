<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>印章系統後台管理</title>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Admin CSS -->
    <link rel="stylesheet" href="admin.css">
    
    <!-- 防止被 iframe 嵌入 -->
    <script>
        if (window.top !== window.self) {
            window.top.location = window.self.location;
        }
    </script>
    
    <style>
        /* 初始載入樣式 */
        body {
            margin: 0;
            padding: 0;
            background: var(--admin-bg-primary, #0a0a0a);
            color: var(--admin-text-primary, #ffffff);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            overflow: hidden;
        }
        
        /* 載入畫面 */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--admin-bg-primary, #0a0a0a);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-content {
            text-align: center;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(106, 27, 154, 0.2);
            border-top-color: var(--admin-accent, #6a1b9a);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: var(--admin-text-secondary, #b0b0b0);
            font-size: 14px;
        }
        
        /* 防截圖保護層 */
        .screenshot-protection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            color: #fff;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 10000;
        }
        
        .screenshot-protection .material-icons {
            font-size: 72px;
            margin-bottom: 20px;
            color: #ff5252;
        }
        
        /* 浮水印層 */
        .watermark-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            opacity: 0.05;
            display: none; /* 後台預設不顯示 */
        }
        
        .watermark-text {
            position: absolute;
            color: var(--admin-accent, #6a1b9a);
            font-size: 12px;
            font-weight: 500;
            transform: rotate(-45deg);
            user-select: none;
            white-space: nowrap;
        }
        
        /* 禁用選取 */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body class="no-select">
    <!-- 載入畫面 -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">系統載入中...</div>
        </div>
    </div>
    
    <!-- 主要內容區域 (由 JavaScript 動態生成) -->
    
    <!-- 防截圖保護層 -->
    <div id="screenshotProtection" class="screenshot-protection">
        <span class="material-icons">no_photography</span>
        <p>禁止截圖</p>
    </div>
    
    <!-- 浮水印層 (後台用) -->
    <div id="watermarkLayer" class="watermark-layer"></div>
    
    <!-- 載入必要的函式庫 -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    
    <!-- Admin JavaScript -->
    <script src="admin.js"></script>
    
    <script>
        // 系統初始化
        window.addEventListener('load', function() {
            // 移除載入畫面
            setTimeout(() => {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => loadingScreen.remove(), 300);
                }
            }, 500);
        });
        
        // 防止開發者工具快捷鍵（基本防護）
        document.addEventListener('keydown', function(e) {
            // F12
            if (e.keyCode === 123) {
                e.preventDefault();
                return false;
            }
            // Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+Shift+C
            if (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74 || e.keyCode === 67)) {
                e.preventDefault();
                return false;
            }
            // Ctrl+U
            if (e.ctrlKey && e.keyCode === 85) {
                e.preventDefault();
                return false;
            }
        });
        
        // 防止右鍵選單（基本防護）
        document.addEventListener('contextmenu', function(e) {
            if (!e.ctrlKey) { // 允許 Ctrl+右鍵用於開發
                e.preventDefault();
                return false;
            }
        });
        
        // 偵測頁面可見性變化（防截圖）
        document.addEventListener('visibilitychange', function() {
            // 這個功能將由 admin.js 根據設定控制
        });
        
        // 防止拖曳
        document.addEventListener('dragstart', function(e) {
            if (e.target.tagName === 'IMG') {
                e.preventDefault();
                return false;
            }
        });
        
        // 防止列印
        window.addEventListener('beforeprint', function(e) {
            // 這個功能將由 admin.js 根據設定控制
        });
        
        // 偵測視窗失焦
        window.addEventListener('blur', function() {
            // 這個功能將由 admin.js 根據設定控制
        });
        
        // 系統訊息
        console.log('%c⚠️ 警告！', 'color: red; font-size: 30px; font-weight: bold;');
        console.log('%c此為印章系統後台管理介面，請勿進行任何未授權的操作。', 'color: red; font-size: 16px;');
        console.log('%c所有操作都將被記錄。', 'color: orange; font-size: 14px;');
    </script>
    
    <!-- 效能監控 -->
    <script>
        // 簡單的效能監控
        window.addEventListener('load', function() {
            if (window.performance) {
                const perfData = window.performance.timing;
                const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
                console.log('頁面載入時間:', pageLoadTime + 'ms');
            }
        });
        
        // 錯誤捕捉
        window.addEventListener('error', function(e) {
            console.error('系統錯誤:', e.error);
            // 可以將錯誤發送到伺服器記錄
        });
        
        // 未處理的 Promise 錯誤
        window.addEventListener('unhandledrejection', function(e) {
            console.error('未處理的 Promise 錯誤:', e.reason);
            e.preventDefault();
        });
    </script>
    
    <!-- 瀏覽器相容性檢查 -->
    <script>
        // 檢查必要的 API 支援
        (function() {
            const requiredFeatures = [
                'Promise',
                'fetch',
                'localStorage',
                'sessionStorage',
                'FileReader',
                'Blob',
                'URL'
            ];
            
            const unsupported = requiredFeatures.filter(feature => !(feature in window));
            
            if (unsupported.length > 0) {
                console.warn('瀏覽器不支援以下功能:', unsupported);
                alert('您的瀏覽器版本過舊，請更新到最新版本以獲得最佳體驗。');
            }
        })();
    </script>
    
    <!-- 自動儲存提示 -->
    <script>
        // 定期提醒儲存（如果有未儲存的變更）
        let unsavedChanges = false;
        
        window.addEventListener('beforeunload', function(e) {
            if (unsavedChanges) {
                e.preventDefault();
                e.returnValue = '您有未儲存的變更，確定要離開嗎？';
            }
        });
        
        // 標記未儲存的變更
        window.markUnsavedChanges = function() {
            unsavedChanges = true;
        };
        
        // 清除未儲存標記
        window.clearUnsavedChanges = function() {
            unsavedChanges = false;
        };
    </script>
    
    <!-- 網路狀態監控 -->
    <script>
        // 監控網路連線狀態
        window.addEventListener('online', function() {
            console.log('網路已連線');
            if (window.showNotification) {
                window.showNotification('網路已恢復連線', 'success');
            }
        });
        
        window.addEventListener('offline', function() {
            console.log('網路已斷線');
            if (window.showNotification) {
                window.showNotification('網路連線中斷，部分功能可能無法使用', 'warning');
            }
        });
    </script>
    
    <!-- Meta 標籤 -->
    <meta name="robots" content="noindex, nofollow">
    <meta name="theme-color" content="#6a1b9a">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- 防止快取敏感資料 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</body>
</html>
